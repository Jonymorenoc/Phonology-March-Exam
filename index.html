<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Second Grade Vocabulary Exam</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet" />

  <!-- Inline Styles -->
  <style>
    :root {
      --primary: #2A4270;
      --secondary: #FF693A;
      --accent: #FF693A;
      --background: #F6F4EE;
      --text-dark: #000000;
      --text-light: #FFFFFF;
      --button-hover: #FF5722;
      --button-active: #E64A19;
      --feedback-correct: #C8F7C5;
      --feedback-incorrect: #FFD8D2;
      --feedback-border-correct: #2ECC71;
      --feedback-border-incorrect: #E74C3C;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Comic Neue', cursive;
      background: var(--background);
      color: var(--text-dark);
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      min-height: 100vh;
    }
    
    header {
      text-align: center;
      margin-bottom: 2rem;
      padding: 1rem;
      background-color: var(--primary);
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    
    h1 {
      color: var(--text-light);
      font-size: 2.5rem;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
    }
    
    .emoji-header {
      font-size: 2.5rem;
      margin: 1rem 0;
      animation: bounce 2s infinite;
    }
    
    .bubble {
      background: rgba(255, 105, 58, 0.1);
      border: 2px solid var(--secondary);
      padding: 1rem 1.5rem;
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.5rem auto;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      font-size: 1.2rem;
      color: var(--text-dark);
      width: 80%;
      max-width: 600px;
    }
    
    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1.5rem;
      padding: 1rem;
    }
    
    .menu-btn {
      background: var(--primary);
      border: none;
      border-radius: 10px;
      padding: 1.5rem;
      font-size: 1.1rem;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      color: var(--text-light);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      text-align: center;
    }
    
    .menu-btn:hover {
      background: var(--button-hover);
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    
    .menu-btn:active {
      background: var(--button-active);
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .lesson-section {
      display: none;
      padding: 2rem;
      background: #FFFFFF;
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    
    .exercise-card {
      margin: 1.5rem 0;
      padding: 1.5rem;
      border-radius: 10px;
      background: #FFFFFF;
      position: relative;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      border: 1px solid #e0e0e0;
      transition: transform 0.2s;
    }
    
    .exercise-card:hover {
      transform: scale(1.01);
    }
    
    .exercise-card::before {
      content: "‚ú®";
      position: absolute;
      top: -10px;
      left: -10px;
      font-size: 1.2rem;
    }

    /* For letter-selection in Section 1 */
    .letters-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 1rem;
    }
    .letter-btn {
      padding: 0.8rem;
      border: 2px solid var(--secondary);
      border-radius: 8px;
      background: #FFFFFF;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease;
      font-size: 1rem;
      min-width: 40px;
      text-align: center;
    }
    .letter-btn:hover:not(:disabled) {
      background: var(--secondary);
      color: var(--text-light);
    }
    .letter-btn:disabled {
      opacity: 0.6;
      cursor: default;
    }
    
    .options-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
    }
    
    .option-btn {
      padding: 0.8rem;
      border: 2px solid var(--secondary);
      border-radius: 8px;
      background: #FFFFFF;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease;
      font-size: 1rem;
      text-align: center;
      color: var(--text-dark);
    }
    
    .option-btn:hover:not(:disabled) {
      background: var(--secondary);
      color: var(--text-light);
    }
    
    .option-btn:disabled {
      cursor: default;
      opacity: 0.6;
    }

    /* For multi-selection in Section 4 */
    .multiselect-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
      gap: 0.5rem;
      margin: 1rem 0;
    }
    .multiselect-item {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      border: 2px solid var(--secondary);
      border-radius: 8px;
      padding: 0.5rem;
      background: #FFFFFF;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease;
    }
    .multiselect-item input[type="checkbox"] {
      cursor: pointer;
    }
    .multiselect-item:hover:not(.selected) {
      background: var(--secondary);
      color: var(--text-light);
    }
    .multiselect-item.selected {
      background: var(--secondary);
      color: var(--text-light);
    }
    
    .text-input,
    textarea {
      padding: 0.8rem;
      border: 2px solid var(--secondary);
      border-radius: 8px;
      font-size: 1rem;
      width: 100%;
      color: var(--text-dark);
    }
    
    .submit-btn {
      margin-top: 0.5rem;
      padding: 0.6rem 1rem;
      border: none;
      border-radius: 8px;
      background: var(--secondary);
      color: var(--text-light);
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
      font-size: 1rem;
    }
    
    .submit-btn:hover:not(:disabled) {
      background: var(--button-hover);
      transform: translateY(-2px);
    }
    
    .submit-btn:active {
      background: var(--button-active);
      transform: translateY(0);
    }
    
    .submit-btn:disabled {
      cursor: default;
      opacity: 0.6;
    }
    
    .feedback {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 8px;
      animation: popIn 0.3s ease;
      font-weight: bold;
      text-align: center;
    }
    
    .feedback.correct {
      background: var(--feedback-correct);
      border: 2px solid var(--feedback-border-correct);
      color: var(--text-dark);
    }
    
    .feedback.incorrect {
      background: var(--feedback-incorrect);
      border: 2px solid var(--feedback-border-incorrect);
      color: var(--text-dark);
    }
    
    .try-again-btn {
      margin-top: 0.5rem;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 8px;
      background: var(--secondary);
      color: var(--text-light);
      cursor: pointer;
      transition: background 0.3s ease;
      font-size: 1rem;
    }
    
    .try-again-btn:hover {
      background: var(--button-hover);
    }
    
    .explanation {
      background: #FFFFFF;
      padding: 1.5rem;
      border-radius: 10px;
      margin: 1rem 0;
      border-left: 5px solid var(--secondary);
      color: var(--text-dark);
    }
    
    .back-btn {
      background: var(--secondary);
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 1rem;
      transition: background 0.3s ease, transform 0.2s ease;
      font-size: 1rem;
      color: var(--text-light);
    }
    
    .back-btn:hover {
      background: var(--button-hover);
      transform: translateY(-2px);
    }
    
    footer {
      text-align: center;
      margin-top: 2rem;
      padding: 1rem;
      background-color: var(--primary);
      border-radius: 15px;
      color: var(--text-light);
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes popIn {
      from { transform: scale(0.95); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    
    /* TIP Panel at Bottom */
    .tip-panel {
      position: fixed;
      left: 0; 
      right: 0;
      bottom: 0;
      background-color: #fff;
      border-top: 3px solid var(--secondary);
      box-shadow: 0 -3px 10px rgba(0,0,0,0.15);
      z-index: 9999;
      transition: max-height 0.3s ease;
      overflow: hidden;
    }
    
    .tip-panel.closed {
      max-height: 40px;
    }
    
    .tip-panel.open {
      max-height: 200px;
    }
    
    .tip-toggle-bar {
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--secondary);
      color: #fff;
      padding: 0.5rem 1rem;
      cursor: pointer;
      font-size: 1rem;
      font-weight: bold;
    }
    
    .tip-content {
      padding: 1rem;
      background: #fff;
      color: var(--text-dark);
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      .menu-grid {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      }
      
      .menu-btn {
        padding: 1rem;
        min-height: 80px;
        font-size: 1rem;
      }
      
      .emoji-header {
        font-size: 2.5rem;
      }
      
      .bubble {
        font-size: 1rem;
        width: 90%;
      }
      
      .option-btn, .word-btn, .letter-btn {
        font-size: 0.9rem;
        padding: 0.6rem;
        margin: 0.3rem;
      }
      
      .text-input, textarea {
        font-size: 0.9rem;
        padding: 0.6rem;
      }
      
      .submit-btn {
        font-size: 0.9rem;
        padding: 0.5rem 0.8rem;
      }
      
      .try-again-btn {
        font-size: 0.9rem;
        padding: 0.4rem 0.7rem;
      }
      
      .exercise-card {
        padding: 1rem;
      }
      
      .back-btn {
        padding: 0.6rem 1rem;
        font-size: 0.9rem;
      }
      
      .tip-panel.closed {
        max-height: 35px;
      }
      .tip-panel.open {
        max-height: 150px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Second Grade Vocabulary Exam</h1>
      <div class="emoji-header">üìùüìö</div>
    </header>

    <main class="content">
      <!-- Menu Section -->
      <section class="welcome active">
        <div class="bubble">üéà Choose Your Exam Section! üëá</div>
        <div class="menu-grid"></div>
      </section>

      <!-- Exam Section Details -->
      <section class="lesson-section"></section>
    </main>

    <footer>
      <p>Created for Second Grade by Your Teacher</p>
    </footer>
  </div>

  <!-- Collapsible Tip Panel -->
  <div id="tip-panel" class="tip-panel closed">
    <div class="tip-toggle-bar" id="tip-toggle-bar">
      <span id="tip-toggle-text">Show Tip</span>
    </div>
    <div class="tip-content" id="tip-content"></div>
  </div>

  <!-- Inline Script -->
  <script>
    /*************************************************************
     * Vocabulary -> Emoji Mapping
     *************************************************************/
    const vocabEmojis = {
      'coin': 'ü™ô',
      'cowboy': 'ü§†',
      'pie': 'ü•ß',
      'tie': 'üëî',
      'ice': 'üßä',
      'oil': 'üõ¢Ô∏è',
      'five': '5Ô∏è‚É£',
      'jar': 'üçØ',
      'jacket': 'üß•',
      'gift': 'üéÅ',
      'ghost': 'üëª',
      'game': 'üéÆ',
      'big': 'ü¶ñ',
      'jet': '‚úàÔ∏è',
      'book': 'üìö',
      'cook': 'üç≥',
      'wood': 'ü™µ',
      'moon': 'üåô',
      'spoon': 'ü•Ñ',
      'food': 'üçΩÔ∏è',
      'foot': 'ü¶∂'
    };

    /*************************************************************
     * All Vocabulary
     *************************************************************/
    const allVocabulary = [
      "coin","cowboy","pie","tie","ice","oil","five","jar","jacket","gift",
      "ghost","game","big","jet","book","cook","wood","moon","spoon","food","foot"
    ];

    /*************************************************************
     * Trap words for Section 4 (max 3)
     *************************************************************/
    const trapWords = ["house","desk","ring"];

    /*************************************************************
     * Exam Data
     *************************************************************/
    const exam = {
      // SECTION 1 - letter selection (with item-based emojis)
      fillInTheBlanks: {
        title: "Section 1: Fill in the Blanks",
        tip: "üí° Tip: Select the letters in the correct order to form the missing word. Watch out for extra letters that don't belong!",
        exercises: [
          { q: "He paid with a shiny ______ to buy a snack.", t: "letters", a: "coin" },
          { q: "The brave ______ rode his horse through the desert.", t: "letters", a: "cowboy" },
          { q: "She baked a delicious ______ for dessert.", t: "letters", a: "pie" },
          { q: "He wore a fancy ______ around his neck at the wedding.", t: "letters", a: "tie" },
          { q: "Please put the ______ in the freezer so it stays cold.", t: "letters", a: "ice" },
          { q: "She used to ______ the vegetables.", t: "letters", a: "cook" },
          { q: "My little sister just turned ______ years old.", t: "letters", a: "five" },
          { q: "We kept the homemade jam in a glass ______.", t: "letters", a: "jar" },
          { q: "It was cold outside, so she wore her ______.", t: "letters", a: "jacket" },
          { q: "He wrapped the ______ for his friend‚Äôs birthday.", t: "letters", a: "gift" },
          { q: "They told a spooky story about a wandering ______.", t: "letters", a: "ghost" },
          { q: "We played a fun board ______ after dinner.", t: "letters", a: "game" },
          { q: "That dog is quite ______ compared to the puppy.", t: "letters", a: "big" },
          { q: "The ______ sped down the runway and took off.", t: "letters", a: "jet" },
          { q: "I read a ______ before going to sleep.", t: "letters", a: "book" },
          { q: "My dad loves to ______ pancakes for breakfast.", t: "letters", a: "cook" },
          { q: "The house was built with sturdy ______.", t: "letters", a: "wood" },
          { q: "The ______ shone brightly in the night sky.", t: "letters", a: "moon" },
          { q: "She stirred her soup with a large ______.", t: "letters", a: "spoon" },
          { q: "We bought fresh ______ at the grocery store.", t: "letters", a: "food" },
          { q: "After running all day, my ______ began to ache.", t: "letters", a: "foot" }
        ]
      },

      // SECTION 2 - rhymes
      rhymes: {
        title: "Section 2: Which Word Rhymes With‚Ä¶",
        tip: "üí° Tip: Listen to the sound of the word and choose the option that best rhymes.",
        exercises: [
          { q: '1. Which word rhymes with "join"?', o: ["pie", "coin", "cook"], a: "coin" },
          { q: '2. Which word rhymes with "toy"?', o: ["cowboy", "foot", "jar"], a: "cowboy" },
          { q: '3. Which word rhymes with "sky"?', o: ["tie", "oil", "book"], a: "tie" },
          { q: '4. Which word rhymes with "why"?', o: ["ghost", "pie", "big"], a: "pie" },
          { q: '5. Which word rhymes with "mice"?', o: ["ice", "spoon", "five"], a: "ice" },
          { q: '6. Which word rhymes with "boil"?', o: ["jet", "oil", "cook"], a: "oil" },
          { q: '7. Which word rhymes with "hive"?', o: ["gift", "five", "game"], a: "five" },
          { q: '8. Which word rhymes with "car"?', o: ["jar", "cowboy", "moon"], a: "jar" },
          { q: '9. Which word rhymes with "packet"?', o: ["jacket", "foot", "wood"], a: "jacket" },
          { q: '10. Which word rhymes with "lift"?', o: ["gift", "ghost", "oil"], a: "gift" },
          { q: '11. Which word rhymes with "most"?', o: ["spoon", "ghost", "food"], a: "ghost" },
          { q: '12. Which word rhymes with "same"?', o: ["five", "game", "big"], a: "game" },
          { q: '13. Which word rhymes with "dig"?', o: ["big", "tie", "coin"], a: "big" },
          { q: '14. Which word rhymes with "bet"?', o: ["cowboy", "jet", "foot"], a: "jet" },
          { q: '15. Which word rhymes with "look"?', o: ["book", "spoon", "moon"], a: "book" },
          { q: '16. Which word rhymes with "shook"?', o: ["cook", "pie", "jacket"], a: "cook" },
          { q: '17. Which word rhymes with "could"?', o: ["wood", "coin", "oil"], a: "wood" },
          { q: '18. Which word rhymes with "tune"?', o: ["tie", "cowboy", "moon"], a: "moon" },
          { q: '19. Which word rhymes with "balloon"?', o: ["spoon", "jar", "big"], a: "spoon" },
          { q: '20. Which word rhymes with "mood"?', o: ["food", "foot", "game"], a: "food" },
          { q: '21. Which word rhymes with "put"?', o: ["foot", "ghost", "five"], a: "foot" }
        ]
      },

      // SECTION 3 - circle and write
      circleAndWrite: {
        title: "Section 3: Circle and Write the Word",
        tip: "üí° Tip: Choose the correct word from the options and write it clearly in the blank.",
        exercises: [
          { q: "1. He dropped a small ______ into the fountain.", o: ["cowboy", "coin", "game"], a: "coin" },
          { q: "2. My cousin wants to be a ______ and ride horses.", o: ["cowboy", "jet", "jar"], a: "cowboy" },
          { q: "3. She baked a delicious cherry ______ for dessert.", o: ["gift", "pie", "oil"], a: "pie" },
          { q: "4. He wore a ______ with his shirt for the wedding.", o: ["tie", "ghost", "moon"], a: "tie" },
          { q: "5. Put the ______ in the freezer before it melts.", o: ["food", "spoon", "ice"], a: "ice" },
          { q: "6. She added a little ______ to the pan before cooking.", o: ["oil", "foot", "wood"], a: "oil" },
          { q: "7. He just turned ______ years old today.", o: ["big", "five", "cook"], a: "five" },
          { q: "8. We kept sugar cookies in a ceramic ______.", o: ["jar", "jacket", "foot"], a: "jar" },
          { q: "9. It was so cold that she wore her thick ______.", o: ["foot", "jacket", "tie"], a: "jacket" },
          { q: "10. He wrapped the ______ with bright paper and a bow.", o: ["gift", "jet", "cowboy"], a: "gift" },
          { q: "11. The old house was said to have a friendly ______.", o: ["game", "book", "ghost"], a: "ghost" },
          { q: "12. We played a new board ______ last night.", o: ["game", "foot", "oil"], a: "game" },
          { q: "13. That elephant is very ______ compared to a cat.", o: ["big", "five", "pie"], a: "big" },
          { q: "14. The ______ roared down the runway before takeoff.", o: ["spoon", "jet", "ghost"], a: "jet" },
          { q: "15. He read a good ______ about animals.", o: ["coin", "foot", "book"], a: "book" },
          { q: "16. Mom likes to ______ pancakes for breakfast.", o: ["cook", "jar", "cowboy"], a: "cook" },
          { q: "17. The table was made of solid ______.", o: ["wood", "moon", "big"], a: "wood" },
          { q: "18. The ______ shone brightly in the sky last night.", o: ["spoon", "jacket", "moon"], a: "moon" },
          { q: "19. He stirred the soup with a wooden ______.", o: ["spoon", "foot", "game"], a: "spoon" },
          { q: "20. We bought some ______ at the market for dinner.", o: ["foot", "food", "ghost"], a: "food" },
          { q: "21. My ______ hurts after walking all day.", o: ["foot", "tie", "cook"], a: "foot" }
        ]
      },

      // SECTION 4 - multi-selection (no emojis in question text)
      phonicsSpelling: {
        title: "Section 4: Phonics and Spelling Patterns",
        tip: "üí° Tip: Focus on the sounds and spellings. Use each vocabulary word to answer the questions.",
        exercises: [
          {
            q: "1. Which 3 words contain the short ‚Äúoo‚Äù sound (as in ‚Äúhook‚Äù)?",
            t: "multiselect",
            a: ["book", "cook", "foot"]
          },
          {
            q: "2. Which 3 words contain the long ‚Äúoo‚Äù sound (as in ‚Äúboot‚Äù)?",
            t: "multiselect",
            a: ["moon", "spoon", "food"]
          },
          {
            q: "3. Which 2 words have the ‚Äúoi‚Äù sound spelled ‚Äúoi‚Äù?",
            t: "multiselect",
            a: ["coin", "oil"]
          },
          {
            q: "4. Which 4 words end with a silent ‚Äúe‚Äù?",
            t: "multiselect",
            a: ["pie", "tie", "five", "game"]
          },
          {
            q: "5. Which 3 words begin with the letters ‚Äúj‚Äù or ‚Äúja‚Äù?",
            t: "multiselect",
            a: ["jar", "jacket", "jet"]
          },
          {
            q: "6. Which 3 words begin with ‚Äúco‚Äù?",
            t: "multiselect",
            a: ["coin", "cowboy", "cook"]
          },
          {
            q: "7. Which 2 words are typically used to stir or store things in the kitchen?",
            t: "multiselect",
            a: ["spoon", "jar"]
          },
          {
            q: "8. Which word is a body part used for walking?",
            t: "multiselect",
            a: ["foot"]
          },
          {
            q: "9. Which word means a present or something you give someone?",
            t: "multiselect",
            a: ["gift"]
          },
          {
            q: "10. Which word is a sweet, round dessert often baked with fruit?",
            t: "multiselect",
            a: ["pie"]
          },
          {
            q: "11. Which word is the material from trees and is used for building?",
            t: "multiselect",
            a: ["wood"]
          },
          {
            q: "12. Which word refers to a spooky figure said to haunt houses?",
            t: "multiselect",
            a: ["ghost"]
          },
          {
            q: "13. Which word is worn around your neck with a dress shirt?",
            t: "multiselect",
            a: ["tie"]
          },
          {
            q: "14. Which word refers to a large airplane?",
            t: "multiselect",
            a: ["jet"]
          },
          {
            q: "15. Which 2 words can describe something you read or do for fun? (One for reading, one for playing)",
            t: "multiselect",
            a: ["book", "game"]
          },
          {
            q: "16. Which word is used to prepare a meal?",
            t: "multiselect",
            a: ["cook"]
          },
          {
            q: "17. Which word is an amount of money made of metal?",
            t: "multiselect",
            a: ["coin"]
          },
          {
            q: "18. Which word is a type of job for a Western rider?",
            t: "multiselect",
            a: ["cowboy"]
          },
          {
            q: "19. Which word is a short word for ‚Äúvery large‚Äù?",
            t: "multiselect",
            a: ["big"]
          },
          {
            q: "20. Which word can be a sweet frozen cube that melts in heat?",
            t: "multiselect",
            a: ["ice"]
          },
          {
            q: "21. Which word means ‚Äúnourishment‚Äù or ‚Äúthings we eat‚Äù?",
            t: "multiselect",
            a: ["food"]
          }
        ]
      },

      // SECTION 5 - dictation with new sentences
      dictation: {
        title: "Section 5: Dictation",
        tip: "üí° Tip: Read the sentence carefully and practice writing it down correctly. Click 'Choose Random Text' to get a new sentence."
      }
    };

    /*************************************************************
     * Shuffle Array Helper
     *************************************************************/
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // Fallback emojis for menu button headings
    const fallbackEmojis = ["üòä", "üëç", "üåü", "üéâ", "üí°", "üöÄ"];

    /*************************************************************
     * Generate a Random Dictation Sentence (Section 5)
     *************************************************************/
    function generateDictationText() {
      const dictationSentences = [
        "The cowboy tipped his hat to the baker selling pie at the fair.",
        "A ghostly figure floated near the old wooden jar of oil.",
        "She stirred the stew with a spoon while reading a book.",
        "He slipped on ice and left a muddy footprint on the path.",
        "The cook prepared five spicy dishes for the food festival.",
        "They launched a toy jet into the sky under the full moon.",
        "A rusty coin was hidden inside the dusty cookbook.",
        "She wrapped the gift in paper decorated with tiny ghosts.",
        "The librarian placed a big jar of bookmarks on the counter.",
        "He carved a wooden spoon as a gift for his grandmother.",
        "The cowboy‚Äôs jacket had patches from every town he visited.",
        "Children played a game to find coins buried in the sand.",
        "The spilled oil stained his favorite tie beyond repair.",
        "They roasted marshmallows over a fire made of dry wood.",
        "A big moon illuminated the trail as they hiked at night.",
        "She packed a jar of homemade pie filling for the picnic.",
        "The pilot‚Äôs jacket was found crumpled inside the crashed jet.",
        "He balanced a coin on his foot during the silly game.",
        "The ghost story mentioned a treasure hidden under ice.",
        "Five pies cooled on the windowsill, tempting passersby.",
        "They used a spoon to dig for buried treasure in the sand.",
        "The recipe required five cups of flour and a jar of oil.",
        "A leather-bound book was the perfect gift for the teacher.",
        "The cowboy‚Äôs boot left a deep imprint in the soft mud.",
        "She wore a tie dyed with colors resembling the northern lights.",
        "A big jar of pickles sat beside the loaf of bread.",
        "The ice sculpture melted into a puddle shaped like a foot.",
        "They played a board game with pieces carved from wood.",
        "The chef used a spoon to drizzle oil over the salad.",
        "He found an old coin while flipping through the cookbook.",
        "The jet soared past the moon, leaving a trail of clouds.",
        "A ghostly whisper echoed through the empty food pantry.",
        "She tied the gift box with ribbon and a sprig of pine.",
        "The cookbook featured a recipe for ice cream made with oil.",
        "He wore a jacket lined with pockets for coins and keys.",
        "The cowboy‚Äôs horse knocked over a jar of apple cider.",
        "They built a fire using wood and lit it with a magnifying glass.",
        "A big spoon was used to serve the hearty beef stew.",
        "The children pretended the moon was made of blue cheese.",
        "She painted a ghost holding a jar of glowing fireflies.",
        "He polished his leather boots until they shone like jet.",
        "The librarian stamped the due date inside each borrowed book.",
        "They played hide-and-seek among the big trees in the forest.",
        "A coin-operated machine dispensed tiny toys for five cents.",
        "The ice cubes clinked in the glass as she read her book.",
        "He donated a warm jacket and a pair of gloves to the shelter.",
        "The cowboy‚Äôs lasso looped around a barrel labeled ‚Äúoil.‚Äù",
        "She balanced a spoon on her nose during the comedy game.",
        "The ghost story scared him so much he spilled his food.",
        "They carved a wooden spoon as a gift for the newlyweds.",
        "Five jets flew in formation under the bright afternoon sun.",
        "The jar of honey tipped over, dripping onto the cookbook.",
        "He tied the package with twine and a sprig of lavender.",
        "The full moon cast shadows on the old wooden footbridge.",
        "A coin-shaped pendant hung from her necklace as a good luck charm.",
        "The cowboy‚Äôs hat flew off in the gust from the jet engine.",
        "She used a spoon to mix oil into the cake batter.",
        "The librarian shelved a book about ice ages next to cookbooks.",
        "A big jar of coins sat on the counter for charity.",
        "The children played a game pretending to chase a ghost.",
        "He warmed his hands by the fire, holding a mug of food.",
        "The ice cubes melted into the shape of a tiny foot.",
        "She wrapped the pie in foil to keep it warm for the cook.",
        "The cowboy‚Äôs jacket had a patch shaped like a crescent moon."
      ];
      shuffleArray(dictationSentences);
      return dictationSentences[0];
    }

    /*************************************************************
     * Initialize Menu
     *************************************************************/
    document.addEventListener("DOMContentLoaded", initMenu);
    
    function initMenu() {
      const menuGrid = document.querySelector(".menu-grid");
      menuGrid.innerHTML = "";
      for (let key in exam) {
        const section = exam[key];
        const button = document.createElement("button");
        button.classList.add("menu-btn");
        // For non-dictation sections, also show a fallback emoji
        const btnLabel = section.title + (key === "dictation" ? "" : " " + fallbackEmojis[Math.floor(Math.random() * fallbackEmojis.length)]);
        button.innerHTML = `<div style="text-align:center; font-weight:bold;">${btnLabel}</div>`;
        button.setAttribute("data-section", key);
        button.setAttribute("aria-label", section.title);
        menuGrid.appendChild(button);
      }
      document.querySelectorAll(".menu-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          showSection(btn.getAttribute("data-section"));
        });
      });
    }
    
    /*************************************************************
     * Show a Section
     *************************************************************/
    function showSection(sectionKey) {
      const sectionData = exam[sectionKey];
      const welcomeSection = document.querySelector(".welcome");
      const lessonSection = document.querySelector(".lesson-section");
    
      welcomeSection.classList.remove("active");
      lessonSection.classList.add("active");
      lessonSection.style.display = "block";
    
      // Show tip if available
      if (sectionData.tip) {
        showTipPanel(sectionData.tip);
      } else {
        hideTipPanel();
      }
    
      // If Dictation
      if (sectionKey === "dictation") {
        lessonSection.innerHTML = `
          <button class="back-btn">‚¨ÖÔ∏è Back</button>
          <h2>${sectionData.title}</h2>
          <div class="dictation-text" style="padding:1rem; border: 2px dashed #aaa; border-radius:8px; margin-top:1rem; font-size:125%;">
            <p id="dictation-content">${generateDictationText()}</p>
            <button id="choose-text-btn" class="submit-btn" style="margin-top:1rem;">Choose Random Text</button>
          </div>
        `;
        document.querySelector(".back-btn").addEventListener("click", () => {
          lessonSection.classList.remove("active");
          lessonSection.style.display = "none";
          welcomeSection.classList.add("active");
          hideTipPanel();
        });
        document.getElementById("choose-text-btn").addEventListener("click", () => {
          document.getElementById("dictation-content").innerText = generateDictationText();
        });
        return;
      }
    
      // Shuffle the exercises for random order
      shuffleArray(sectionData.exercises);
    
      lessonSection.innerHTML = `
        <button class="back-btn">‚¨ÖÔ∏è Back</button>
        <h2>${sectionData.title} ${fallbackEmojis[Math.floor(Math.random() * fallbackEmojis.length)]}</h2>
        <div class="explanation">${sectionData.explanation || ""}</div>
        <div class="exercises">
          ${sectionData.exercises.map((ex, idx) => {
              let showEmoji = "";
              
              // SECTION 1 => show item-based emoji
              if (sectionKey === "fillInTheBlanks") {
                const word = ex.a.toLowerCase();
                if (vocabEmojis[word]) {
                  showEmoji = vocabEmojis[word];
                } else {
                  showEmoji = "";
                }
              }
              // SECTION 4 => remove emojis
              else if (sectionKey === "phonicsSpelling") {
                showEmoji = "";
              }
              // SECTION 2, 3 => no item-based emojis
              else if (sectionKey === "rhymes" || sectionKey === "circleAndWrite") {
                showEmoji = "";
              }
    
              if (ex.t === "letters") {
                return `
                  <div class="exercise-card" data-exercise-index="${idx}">
                    <p>${showEmoji} ${ex.q}</p>
                    <div class="letters-grid" data-answer="${ex.a.toLowerCase()}"></div>
                    <div class="feedback" style="display:none;"></div>
                  </div>
                `;
              }
              else if (ex.t === "text") {
                return `
                  <div class="exercise-card" data-exercise-index="${idx}">
                    <p>${showEmoji} ${ex.q}</p>
                    <div class="options-grid">
                      <input type="text" class="text-input" placeholder="Type your answer">
                      <button class="submit-btn">Submit</button>
                    </div>
                    <div class="feedback" style="display:none;"></div>
                  </div>
                `;
              }
              else if (ex.t === "multiselect") {
                return `
                  <div class="exercise-card" data-exercise-index="${idx}">
                    <p>${showEmoji} ${ex.q}</p>
                    <div class="multiselect-grid"></div>
                    <button class="submit-btn" style="margin-top:0.5rem;">Submit</button>
                    <div class="feedback" style="display:none;"></div>
                  </div>
                `;
              }
              else if (ex.o) {
                shuffleArray(ex.o);
                return `
                  <div class="exercise-card" data-exercise-index="${idx}">
                    <p>${showEmoji} ${ex.q}</p>
                    <div class="options-grid">
                      ${ex.o.map(opt => `<button class="option-btn" data-answer="${opt.toLowerCase()}">${opt}</button>`).join("")}
                    </div>
                    <div class="feedback" style="display:none;"></div>
                  </div>
                `;
              } else {
                return `
                  <div class="exercise-card" data-exercise-index="${idx}">
                    <p>${showEmoji} ${ex.q}</p>
                    <div class="feedback" style="display:none;"></div>
                  </div>
                `;
              }
            }).join("")}
        </div>
      `;
    
      document.querySelector(".back-btn").addEventListener("click", () => {
        lessonSection.classList.remove("active");
        lessonSection.style.display = "none";
        welcomeSection.classList.add("active");
        hideTipPanel();
      });
    
      attachExerciseListeners(sectionKey);
    }
    
    /*************************************************************
     * Attach Listeners
     *************************************************************/
    function attachExerciseListeners(sectionKey) {
      const sectionData = exam[sectionKey];
      const lessonSection = document.querySelector(".lesson-section");
    
      // SECTION 1: letter selection
      if (sectionKey === "fillInTheBlanks") {
        const letterExercises = lessonSection.querySelectorAll(".exercise-card");
        letterExercises.forEach(card => {
          const exIndex = parseInt(card.getAttribute("data-exercise-index"));
          const exData = sectionData.exercises[exIndex];
          if (exData.t === "letters") {
            const correctWord = exData.a.trim().toLowerCase();
            const lettersContainer = card.querySelector(".letters-grid");
            const feedback = card.querySelector(".feedback");
            
            const correctLetters = correctWord.split("");
            const numTraps = 3;
            const allPossible = "abcdefghijklmnopqrstuvwxyz".split("");
            let trapLetters = [];
            while (trapLetters.length < numTraps) {
              const randLetter = allPossible[Math.floor(Math.random() * allPossible.length)];
              const totalOccurInCorrect = correctLetters.filter(l => l === randLetter).length;
              const currentOccurInTrap = trapLetters.filter(l => l === randLetter).length;
              if (totalOccurInCorrect === 0 && currentOccurInTrap === 0) {
                trapLetters.push(randLetter);
              }
            }
            const letterPool = [...correctLetters, ...trapLetters];
            shuffleArray(letterPool);
    
            let nextLetterIndex = 0;
            
            letterPool.forEach(letter => {
              const btn = document.createElement("button");
              btn.classList.add("letter-btn");
              btn.textContent = letter;
              btn.addEventListener("click", () => {
                if (letter === correctLetters[nextLetterIndex]) {
                  btn.style.backgroundColor = "#C8F7C5";
                  btn.style.borderColor = "#2ECC71";
                  btn.disabled = true;
                  nextLetterIndex++;
                  if (nextLetterIndex >= correctLetters.length) {
                    feedback.style.display = "block";
                    feedback.innerHTML = `‚úÖ Correct! The word was "${exData.a}".`;
                    feedback.classList.add("correct");
                    feedback.classList.remove("incorrect");
                    lettersContainer.querySelectorAll(".letter-btn").forEach(b => (b.disabled = true));
                  }
                } else {
                  btn.style.backgroundColor = "#FFD8D2";
                  btn.style.borderColor = "#E74C3C";
                  setTimeout(() => {
                    btn.style.backgroundColor = "#FFFFFF";
                    btn.style.borderColor = "var(--secondary)";
                  }, 500);
                }
              });
              lettersContainer.appendChild(btn);
            });
          }
        });
      }
    
      // SECTION 4: multi-selection
      if (sectionKey === "phonicsSpelling") {
        const multiExercises = lessonSection.querySelectorAll(".exercise-card");
        multiExercises.forEach(card => {
          const exIndex = parseInt(card.getAttribute("data-exercise-index"));
          const exData = sectionData.exercises[exIndex];
          if (exData.t === "multiselect") {
            const grid = card.querySelector(".multiselect-grid");
            const feedback = card.querySelector(".feedback");
            const submitBtn = card.querySelector(".submit-btn");
    
            const correctAnswers = Array.isArray(exData.a) ? exData.a : [exData.a];
            const numberOfTrapsToAdd = Math.max(0, 6 - correctAnswers.length); 
            shuffleArray(trapWords);
            const chosenTraps = trapWords.slice(0, numberOfTrapsToAdd);
    
            const possibleAnswers = [...correctAnswers, ...chosenTraps];
            shuffleArray(possibleAnswers);
    
            possibleAnswers.forEach(word => {
              const itemDiv = document.createElement("div");
              itemDiv.classList.add("multiselect-item");
              itemDiv.innerHTML = `
                <input type="checkbox" value="${word}">
                <label>${word}</label>
              `;
              itemDiv.addEventListener("click", (e) => {
                if (e.target.tagName.toLowerCase() !== "input") {
                  const checkbox = itemDiv.querySelector("input[type='checkbox']");
                  checkbox.checked = !checkbox.checked;
                }
                itemDiv.classList.toggle("selected", itemDiv.querySelector("input").checked);
              });
              grid.appendChild(itemDiv);
            });
    
            submitBtn.addEventListener("click", () => {
              const checkedBoxes = grid.querySelectorAll("input[type='checkbox']:checked");
              const selectedWords = Array.from(checkedBoxes).map(cb => cb.value);
    
              const correctSet = new Set(correctAnswers);
              const selectedSet = new Set(selectedWords);
    
              let isCorrect = (correctSet.size === selectedSet.size);
              if (isCorrect) {
                for (let word of correctSet) {
                  if (!selectedSet.has(word)) {
                    isCorrect = false;
                    break;
                  }
                }
              }
    
              feedback.style.display = "block";
              if (isCorrect) {
                feedback.innerHTML = `‚úÖ Correct! Good job.`;
                feedback.classList.add("correct");
                feedback.classList.remove("incorrect");
                submitBtn.disabled = true;
                grid.querySelectorAll("input[type='checkbox']").forEach(cb => cb.disabled = true);
              } else {
                feedback.innerHTML = `‚ùå Incorrect! The correct answer(s): ${correctAnswers.join(", ")} <br>
                  <button class="try-again-btn">Try Again</button>`;
                feedback.classList.add("incorrect");
                feedback.classList.remove("correct");
                feedback.querySelector(".try-again-btn").addEventListener("click", () => {
                  feedback.style.display = "none";
                  grid.querySelectorAll("input[type='checkbox']").forEach(cb => {
                    cb.checked = false;
                    cb.disabled = false;
                    cb.closest(".multiselect-item")?.classList.remove("selected");
                  });
                });
              }
            });
          }
        });
      }
    
      // SECTION 2 & 3: multiple-choice approach
      lessonSection.querySelectorAll(".option-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const exerciseCard = btn.closest(".exercise-card");
          const feedback = exerciseCard.querySelector(".feedback");
          const exIndex = parseInt(exerciseCard.getAttribute("data-exercise-index"));
          const exData = sectionData.exercises[exIndex];
          const correctAnswer = exData.a.trim().toLowerCase();
          const userAnswer = btn.dataset.answer.trim().toLowerCase();
    
          feedback.style.display = "block";
          if (userAnswer === correctAnswer) {
            feedback.innerHTML = `‚úÖ Correct! üéâ`;
            feedback.classList.add("correct");
            feedback.classList.remove("incorrect");
            exerciseCard.querySelectorAll(".option-btn").forEach(b => {
              b.disabled = true;
              b.style.opacity = "0.6";
            });
          } else {
            feedback.innerHTML = `‚ùå Incorrect! The correct answer is: "${exData.a}".<br>
              <button class="try-again-btn">Try Again</button>`;
            feedback.classList.add("incorrect");
            feedback.classList.remove("correct");
            feedback.querySelector(".try-again-btn").addEventListener("click", () => {
              feedback.style.display = "none";
              exerciseCard.querySelectorAll(".option-btn").forEach(b => {
                b.disabled = false;
                b.style.opacity = "1";
              });
            });
          }
        });
      });
    
      // Text input approach
      lessonSection.querySelectorAll(".submit-btn").forEach(btn => {
        const exerciseCard = btn.closest(".exercise-card");
        if (exerciseCard && exerciseCard.querySelector(".text-input")) {
          btn.addEventListener("click", () => {
            const feedback = exerciseCard.querySelector(".feedback");
            const input = exerciseCard.querySelector(".text-input");
            const exIndex = parseInt(exerciseCard.getAttribute("data-exercise-index"));
            const exData = sectionData.exercises[exIndex];
            const correctAnswer = exData.a.trim().toLowerCase();
            const userAnswer = input.value.trim().toLowerCase();
    
            feedback.style.display = "block";
            if (!userAnswer) {
              feedback.innerHTML = "‚ùó Please type an answer.";
              feedback.classList.add("incorrect");
              feedback.classList.remove("correct");
              return;
            }
    
            if (userAnswer === correctAnswer) {
              feedback.innerHTML = `‚úÖ Correct! üéâ`;
              feedback.classList.add("correct");
              feedback.classList.remove("incorrect");
              input.disabled = true;
              btn.disabled = true;
              input.style.opacity = "0.6";
              btn.style.opacity = "0.6";
            } else {
              feedback.innerHTML = `‚ùå Incorrect! The correct answer is: "${exData.a}".<br>
                <button class="try-again-btn">Try Again</button>`;
              feedback.classList.add("incorrect");
              feedback.classList.remove("correct");
              feedback.querySelector(".try-again-btn").addEventListener("click", () => {
                feedback.style.display = "none";
                input.disabled = false;
                btn.disabled = false;
                input.style.opacity = "1";
                btn.style.opacity = "1";
                input.value = "";
              });
            }
          });
        }
      });
    }
    
    /*************************************************************
     * Tip Panel Functions
     *************************************************************/
    const tipPanel = document.getElementById("tip-panel");
    const tipToggleBar = document.getElementById("tip-toggle-bar");
    const tipToggleText = document.getElementById("tip-toggle-text");
    const tipContent = document.getElementById("tip-content");
    
    function showTipPanel(contentHTML) {
      tipPanel.classList.remove("open", "closed");
      tipPanel.classList.add("closed");
      tipPanel.style.display = "block";
      tipContent.innerHTML = contentHTML;
      tipToggleText.textContent = "Show Tip";
      tipToggleBar.addEventListener("click", toggleTipPanel);
    }
    
    function hideTipPanel() {
      tipPanel.classList.remove("open", "closed");
      tipPanel.style.display = "none";
      tipToggleBar.removeEventListener("click", toggleTipPanel);
    }
    
    function toggleTipPanel() {
      if (tipPanel.classList.contains("closed")) {
        tipPanel.classList.remove("closed");
        tipPanel.classList.add("open");
        tipToggleText.textContent = "Hide Tip";
      } else {
        tipPanel.classList.remove("open");
        tipPanel.classList.add("closed");
        tipToggleText.textContent = "Show Tip";
      }
    }
  </script>
</body>
</html>
